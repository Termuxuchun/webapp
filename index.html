<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tap Coin</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            margin: auto;
        }
        .coin {
            font-size: 50px;
            margin: 20px 0;
            cursor: pointer;
        }
        .balance {
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0;
        }
        .menu {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .menu button {
            background: #ffcc00;
            color: black;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 8px;
            width: 30%;
        }
        .menu button:hover {
            background: #ffdd33;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ Tap Coin!</h1>
        <div class="coin" onclick="earnCoin()">ğŸª™</div>
        <p class="balance">Balans: <span id="userBalance">0</span> TAP</p>

        <div class="menu">
            <button onclick="earnCoin()">ğŸ¯ Tap</button>
            <button onclick="upgrade()">âš¡ Upgrade</button>
            <button onclick="airdrop()">ğŸ Airdrop</button>
        </div>

        <div class="menu">
            <button onclick="viewLeaderboard()">ğŸ† Liderlar</button>
            <button onclick="sendCoins()">ğŸ“¤ Coin yuborish</button>
            <button onclick="showCabinet()">ğŸ‘¤ Kabinet</button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let userId = tg.initDataUnsafe?.user?.id || "guest";

        let balance = parseInt(localStorage.getItem(userId + "_balance")) || 0;
        let tapPower = parseInt(localStorage.getItem(userId + "_tapPower")) || 1;
        let airdropHistory = JSON.parse(localStorage.getItem(userId + "_airdrops")) || [];
        let dailyQuest = JSON.parse(localStorage.getItem(userId + "_dailyQuest")) || { completed: false };

        document.getElementById("userBalance").innerText = balance;

        function saveBalance() {
            localStorage.setItem(userId + "_balance", balance);
            localStorage.setItem(userId + "_tapPower", tapPower);
            localStorage.setItem(userId + "_airdrops", JSON.stringify(airdropHistory));
            localStorage.setItem(userId + "_dailyQuest", JSON.stringify(dailyQuest));
        }

        function earnCoin() {
            balance += tapPower;
            saveBalance();
            document.getElementById("userBalance").innerText = balance;
        }

        function upgrade() {
            if (balance >= 100) {
                balance -= 100;
                tapPower += 1;
                saveBalance();
                document.getElementById("userBalance").innerText = balance;
                alert("âœ… Upgrade muvaffaqiyatli! Endi har bosishda " + tapPower + " TAP Coin olasiz.");
            } else {
                alert("âŒ Yetarli TAP Coin yoâ€˜q!");
            }
        }

        function airdrop() {
            let amount = parseInt(prompt("ğŸ Qancha TAP Coin chiqarishni xohlaysiz? (Kamida 1000)"));
            
            if (isNaN(amount) || amount < 1000) {
                alert("âŒ Kamida 1000 TAP Coin chiqarishingiz kerak!");
                return;
            }

            if (balance >= amount) {
                balance -= amount;
                saveBalance();
                document.getElementById("userBalance").innerText = balance;

                let now = new Date().toLocaleString();
                let record = { date: now, amount: amount };
                airdropHistory.push(record);
                saveBalance();

                alert(`ğŸ Siz ${amount} TAP Coin chiqardingiz!`);
            } else {
                alert("âŒ Yetarli TAP Coin yoâ€˜q!");
            }
        }

        function viewLeaderboard() {
            let allUsers = Object.keys(localStorage)
                .filter(key => key.includes("_balance"))
                .map(key => ({ user: key.replace("_balance", ""), balance: parseInt(localStorage.getItem(key)) }))
                .sort((a, b) => b.balance - a.balance)
                .slice(0, 5);

            let leaderboard = allUsers.map((u, i) => `${i + 1}. User ${u.user} - ${u.balance} TAP`).join("\n");
            alert("ğŸ† Liderlar:\n" + leaderboard);
        }

        function sendCoins() {
            let receiverId = prompt("ğŸ“¤ Foydalanuvchi ID sini kiriting:");
            let amount = parseInt(prompt("Nechta TAP Coin yubormoqchisiz?"));

            if (balance >= amount && amount > 0) {
                balance -= amount;
                let receiverBalance = parseInt(localStorage.getItem(receiverId + "_balance")) || 0;
                receiverBalance += amount;
                localStorage.setItem(receiverId + "_balance", receiverBalance);
                saveBalance();
                alert(`âœ… ${amount} TAP Coin foydalanuvchi ${receiverId} ga yuborildi!`);
            } else {
                alert("âŒ Yetarli TAP Coin yoâ€˜q yoki notoâ€˜gâ€˜ri miqdor!");
            }
        }

        function showCabinet() {
            let history = JSON.parse(localStorage.getItem(userId + "_airdrops")) || [];
            let historyText = history.map(h => `ğŸ“… ${h.date} - ğŸ ${h.amount} TAP`).join("\n") || "âŒ Airdrop tarixi yoâ€˜q!";
            
            let questStatus = dailyQuest.completed ? "âœ… Bajardi!" : "âŒ Bajarmadi!";
            
            alert(`ğŸ‘¤ Sizning kabinetingiz:\n\nğŸ’° Balans: ${balance} TAP\nğŸ“œ Airdrop tarixi:\n${historyText}\n\nğŸ¯ Kunlik missiya: ${questStatus}`);
        }
    </script>
</body>
</html>
